<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8"/>
		<title>Arduino Simulator</title>
	</head>
	<body>
		<script>
			var myWorker = new Worker("ArduinoSimulator.js");
			myWorker.onmessage = function(e){document.write(e.data);}

			function convertArduinoSketch(a)
				{
				a = a.replaceAll("Serial.begin","_Serial_Begin");
				a = a.replaceAll("Serial.println","_Serial_Println");
				a = a.replaceAll("Serial.print","_Serial_Print");
				return a;
				}

			function execute()
				{
				var sketch = "void setup(){Serial.begin(9600);Serial.println(\"Hello world!\");}void loop(){Serial.println(\"looping\");}";

				// Converting the Arduino methods and classes (JSCPP doesn't support structs yet)
				sketch = convertArduinoSketch(sketch);

				var code = "#include <iostream>" +

							// main implementation that will execute setup and loop
							"int main(){int internalLoopSystem=0;setup();while(true){loop();internalLoopSystem=internalLoopSystem+1;}return 0;}"

							+

							// setup and loop prototypes implementation
							"void setup();" +
							"void loop();"

							+

							// adding the Arduino sketch
							sketch

							+

							// Serial implementation (JSCPP doesn't support structs yet)
							"void _Serial_Begin(int baudRate);" +
							"void _Serial_Begin(int baudRate){}" +
							"void _Serial_Print(char *text);" +
							"void _Serial_Print(char *text){while(*text){cout << (*text);++text;};}" +
							"void _Serial_Println(char *text);" +
							"void _Serial_Println(char *text){while(*text){cout << (*text);++text;}cout << \"<br/>\";}";

				myWorker.postMessage(code);
				}

			execute();
		</script>
	</body>
</html>